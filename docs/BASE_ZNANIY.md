# База знаний MetalTrack Pro

## Кто такой оператор?

**Оператор** — обычный пользователь системы: кладовщик, менеджер склада или сотрудник, который ежедневно:
- вносит приход и расход металла;
- фиксирует выполненные работы;
- смотрит остатки и справочники.

**Права оператора:**
- Создаёт движения (приход/расход) и работы.
- Просматривает остатки, компании, материалы, тарифы.
- Удаляет **только свои** записи (движения и работы).
- Не видит раздел «История изменений».
- Не может редактировать или удалять чужие записи.

---

## Кто такой администратор?

**Администратор** — пользователь с полным доступом:
- Всё, что может оператор.
- Раздел **«История»** — просмотр аудита (кто, когда, что изменил).
- Редактирование и удаление справочников: компании, материалы, тарифы.
- Удаление **любых** движений и работ (не только своих).

Роль задаётся в Supabase: **Authentication → Users** (при создании пользователя в метаданных указать `role: "admin"` или `role: "operator"`). Либо в таблице `public.users` после первого входа.

---

## Руководство для оператора

### Главная
Сводка: текущий остаток, всего приход, всего расход, сумма работ. График остатков по материалам.

### Движение
Добавление прихода или расхода:
1. Дата, операция (приход/расход).
2. Компания, материал, размер.
3. Владение: «Наш товар» или «На хранении у клиента».
4. Вес (т), стоимость погр./разгр., примечание.

При расходе, если баланс станет отрицательным, система запросит подтверждение.

### Остатки
Просмотр остатков. Можно:
- «Разбить по компаниям» или «Сводно».
- Фильтр по владению: все / только наши / только на хранении.
- Экспорт в CSV.

### Работы
Учёт выполненных услуг: компания, материал (опционально), вид работ (тариф), количество. Сумма считается автоматически.

### Компании, Материалы, Тарифы
Справочники для выбора при создании движений и работ. Оператор только просматривает; редактирование — у администратора.

---

## Руководство для администратора

- **История** — таблица аудита: таблица, запись, действие (создание/изменение/удаление), старые и новые данные, пользователь, дата.
- **Справочники** — полный CRUD: добавление, редактирование, удаление, переключение «Активна/Неактивна» для компаний, материалов и тарифов.
- **Движения и работы** — удаление любых записей (не только своих).

---

## Важные понятия

| Термин | Описание |
|--------|----------|
| **Владение (ownership)** | «Наш товар» — металл принадлежит компании; «На хранении у клиента» — металл клиента на вашем складе. |
| **Позиция** | Уникальная комбинация: компания + материал + размер + владение. Остаток считается по позиции автоматически. |
| **Отрицательный баланс** | При расходе, если остаток станет меньше нуля, система спросит подтверждение. Подтверждайте только при осознанном допуске минуса. |

---

## Вход в систему

- URL приложения → страница входа.
- Email и пароль задаются в Supabase: **Authentication → Users → Add user** (или через Invite).
- После первого входа в таблице `public.users` создаётся запись с полем `role` (по умолчанию `operator`). Админу можно вручную выставить `role = 'admin'` в SQL Editor или через Dashboard.
