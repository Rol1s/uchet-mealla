# Проверка функциональности MetalTrack Pro

Чеклист для убеждения, что всё созданное работает корректно.

---

## 1. Подготовка

- [ ] В Supabase выполнена миграция `supabase/migrations/001_initial_schema.sql` (SQL Editor → вставить → Run).
- [ ] В Supabase созданы минимум 2 пользователя (Authentication → Users):
  - один с ролью **operator** (в `public.users` поле `role = 'operator'`);
  - один с ролью **admin** (`role = 'admin'`).
- [ ] В проекте есть `.env` с `VITE_SUPABASE_URL` и `VITE_SUPABASE_ANON_KEY`.
- [ ] Выполнены `npm install` и `npm run dev`, приложение открывается в браузере.

---

## 2. Авторизация

- [ ] Неавторизованный пользователь перенаправляется на `/login`.
- [ ] Вход с правильными email/паролем открывает главную страницу.
- [ ] Неверный email/пароль показывает сообщение об ошибке.
- [ ] Кнопка «Выйти» в сайдбаре завершает сессию и возвращает на страницу входа.
- [ ] После выхода повторный переход по защищённому URL снова ведёт на `/login`.

---

## 3. Роли: оператор и админ

- [ ] У оператора в меню **нет** пункта «История».
- [ ] У админа в меню **есть** пункт «История».
- [ ] При входе под оператором переход по `/history` вручную показывает «Доступ запрещен» (или редирект).
- [ ] При входе под админом страница «История» открывается и отображает таблицу (пустую или с записями).

---

## 4. Справочники (достаточно проверить под админом)

### Компании
- [ ] Список компаний загружается (пустой или с данными).
- [ ] Добавление компании: кнопка «Добавить» → ввод названия и типа → сохранение, запись появляется в таблице.
- [ ] Редактирование: изменить название/тип/активность → сохранить, изменения отображаются.
- [ ] Удаление: удалить запись, она исчезает из списка.
- [ ] Переключение «Показать неактивные» скрывает/показывает неактивные компании.

### Материалы
- [ ] Список материалов загружается.
- [ ] Добавление, редактирование, удаление, переключение неактивных работают по аналогии с компаниями.

### Тарифы
- [ ] Список тарифов загружается.
- [ ] Добавление услуги (название, единица, цена), редактирование, удаление работают.
- [ ] Переключение «Показать неактивные» работает.

---

## 5. Движения

- [ ] Страница «Движение» открывается, таблица движений загружается (пустая или с данными).
- [ ] «Добавить запись» открывает форму.
- [ ] В форме выбираются: дата, операция (приход/расход), компания, материал, размер, владение (наш/клиента), вес, стоимость, примечание.
- [ ] После сохранения новая запись появляется в таблице с корректными полями (компания, материал, размер, владение, вес).
- [ ] При расходе, приводящем к отрицательному балансу, появляется предупреждение с подтверждением; при отказе запись не создаётся.
- [ ] Удаление своей записи (оператор или админ) удаляет движение; остатки пересчитываются (проверить на странице «Остатки»).
- [ ] Под оператором нельзя удалить чужую запись (или кнопка удаления недоступна/сообщение); под админом можно удалить любую.

---

## 6. Остатки

- [ ] Страница «Остатки» загружается.
- [ ] После добавления прихода/расхода остатки по соответствующей позиции (компания + материал + размер + владение) обновляются.
- [ ] Переключение «Разбить по компаниям» / «Сводно» меняет вид таблицы.
- [ ] Фильтр по владению (все / наши / на хранении) фильтрует строки.
- [ ] Кнопка «Экспорт CSV» скачивает файл с данными таблицы.

---

## 7. Работы

- [ ] Страница «Работы» загружается.
- [ ] «Добавить работу»: выбор компании, материала (опционально), вида работ (тариф), количества, даты; сумма считается автоматически.
- [ ] После сохранения запись появляется в таблице с правильной суммой.
- [ ] Итоговая сумма внизу таблицы совпадает с суммой всех записей.
- [ ] Удаление своей записи (оператор) и любой записи (админ) работает.

---

## 8. Главная (Dashboard)

- [ ] Отображаются карточки: текущий остаток, всего приход, всего расход, сумма работ.
- [ ] Числа согласованы с данными на страницах «Движение», «Остатки» и «Работы».
- [ ] График «Остатки по материалам» отображается (или сообщение «Нет данных» при пустой базе).

---

## 9. История (только админ)

- [ ] Страница «История» открывается.
- [ ] После создания/редактирования/удаления записей в справочниках или движениях/работах в истории появляются соответствующие строки (таблица, действие, пользователь, дата).

---

## 10. База знаний

- [ ] Пункт меню «База знаний» ведёт на страницу помощи.
- [ ] Отображаются разделы: кто такой оператор, руководство для оператора, важные понятия.
- [ ] Под админом дополнительно отображается блок «Руководство для администратора».

---

## Итог

Если все пункты отмечены — система считается полностью проверенной по основному сценарию. При сбоях проверьте консоль браузера (F12) и логи Supabase (Logs) на наличие ошибок.
